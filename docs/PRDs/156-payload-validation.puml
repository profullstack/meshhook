@startuml
!theme plain

title Payload Validation for Webhook Triggers

actor User as user
boundary "UI: Workflow Editor" as UI
control "Webhook Intake Service" as Intake
database "Supabase DB" as DB
entity "JSON Schema Validator" as Validator
control "Webhook Processing Worker" as Worker
queue "Webhook Event Queue" as Queue

user -> UI : Define JSON schema
UI -> DB : Store schema in\nwebhook_triggers
DB --> UI : Confirm schema stored

user -> Intake : Send webhook payload
Intake -> Worker : Push to processing queue
Worker -> DB : Fetch schema for\nwebhook trigger
DB --> Worker : Return schema
Worker -> Validator : Validate payload against schema
alt Validation Success
    Validator --> Worker : Validation passed
    Worker -> Queue : Proceed with workflow execution
else Validation Failure
    Validator --> Worker : Validation error
    Worker -> Intake : Return error message
    Intake --> user : Display error
end

note right of Validator
  Use JSON schema validation library\ncompatible with the tech stack
end note

note over DB
  Schema changes:\nAdd optional payload_schema field\nto webhook_triggers table
end note

note over UI, Worker
  Integration points with existing system
end note

@enduml