@startuml
!theme plain

package "MeshHook Workflow Engine" {
    [Workflow Execution Pipeline] --> [Sanitization Engine]: triggers sanitization
    [Sanitization Engine] --> [Supabase Storage]: sanitized artifacts
    database "Supabase Storage" {
    }
    [Sanitization Engine] ..> [Sanitization Rules Table]: fetches rules
}

package "Configuration and Monitoring" {
    [Configuration API] --> [Sanitization Rules Table]: CRUD operations
    [Audit Logging] ..> [Realtime Log Stream]: streams logs
    [Sanitization Engine] --> [Audit Logging]: logs actions
}

database "Sanitization Rules Table" {
}

[Supabase Storage] <-- [Realtime Log Stream]: logs storage actions

actor User {
    User --> [Configuration API]: defines PII redaction rules
}

note right of [Sanitization Engine]
  Detect and redact PII using:
  - Regex patterns
  - Machine learning models
end note

note right of [Audit Logging]
  Log details:
  - What was redacted
  - By whom
  - When
end note

note right of [Sanitization Rules Table]
  Stores user-defined PII redaction rules:
  - Pattern definitions
  - Action specifications
end note

note right of [Configuration API]
  API Endpoints:
  - GET /projects/{projectId}/sanitization-rules
  - POST /projects/{projectId}/sanitization-rules
end note

@enduml