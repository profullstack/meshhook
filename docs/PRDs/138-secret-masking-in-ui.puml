@startuml
!theme plain

title Secret Masking in UI - Workflow

actor User as user
participant "UI: Svelte Components" as ui
participant "API: SvelteKit SSR/API" as api
database "Supabase Postgres" as db
participant "Realtime Service\n(Supabase Realtime)" as realtime
participant "Secrets Management\nService" as secrets

user -> ui : Request page with secrets
ui -> api : Fetch secrets
api -> db : Query secrets
db -> api : Return secrets
api -> secrets : Request secret masking
secrets -> api : Return masked secrets
api -> ui : Display page with\nmasked secrets
ui -> user : Render masked secrets

ui -> user : User interacts to reveal secret
user -> ui : Request to reveal secret
ui -> api : Verify user permission
api -> db : Check user role
db -> api : Return permission status
alt Permission Granted
  api -> secrets : Request secret decryption
  secrets -> api : Return decrypted secret
  api -> ui : Display decrypted secret temporarily
  ui -> user : Render decrypted secret
else Permission Denied
  api -> ui : Display access denied message
  ui -> user : Render access denied
end

@enduml