@startuml
!theme plain

package "MeshHook System" {
    [Metrics Collection] --> [Database: Postgres]
    [API Endpoints] --> [Database: Postgres]
    [Database: Postgres] --> [Materialized Views Refresh Mechanism]
    database "Database: Postgres" {
        [mv_workflow_metrics] - [Materialized Views]
    }
    [Materialized Views] ..> [Metrics Selection] : aggregates
    [Materialized Views Refresh Mechanism] ..> [mv_workflow_metrics] : updates
}

package "Supabase" {
    [Realtime Monitoring] ..> [Materialized Views Refresh Mechanism] : monitors
    [Database Management] --> [Database: Postgres]
}

[Metrics Collection] --> [Metrics Selection]
[API Endpoints] ..> [Materialized Views] : queries
[Materialized Views] ..> [Query Optimization]

note right of [Materialized Views]
  Key Columns:
  - workflow_id
  - execution_count
  - average_duration
  - success_rate
  - failure_rate
  - last_updated
end note

note right of [Materialized Views Refresh Mechanism]
  Refresh Strategies:
  - On-demand
  - Periodic
end note

note "Integration with existing metrics\ncollection mechanisms" as N1
[Metrics Collection] .. N1
N1 .. [Materialized Views]

note "Documentation\n- Schema Design\n- Refresh Strategy\n- Selected Metrics" as N2
[Materialized Views] .. N2

legend right
  -- Key --
  [ ] : Component
  ..> : Data Flow/Dependency
  --> : Direct Interaction
endlegend

@enduml