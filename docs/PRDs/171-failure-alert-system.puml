@startuml
!define RECTANGLE class

package "MeshHook System" {
  [Workflow Orchestrator] as Orchestrator
  [Supabase Realtime] as Supabase
  [SvelteKit SSR/API] as SvelteKit
  [Notification Dispatcher] as Dispatcher
}

package "Failure Alert System" {
  RECTANGLE "Alert Detection Service" as Detection {
    .. Integration ..
    - Workflow Execution Logs
    - Error States
  }
  RECTANGLE "Alert Settings\nManagement API" as SettingsAPI {
    .. Endpoints ..
    + POST /api/alerts/settings
    + GET /api/alerts/settings/{project_id}/{workflow_id?}
  }
  RECTANGLE "Alert Database" as AlertDB {
    .. Tables ..
    - AlertSettings
    - AlertLogs
  }
}

Orchestrator -down-> Detection : Detects Failures
Detection -right-> Dispatcher : Triggers Alerts
Dispatcher -down-> [Email Provider] : Sends Email Notifications
Dispatcher -down-> [Webhook Provider] : Sends Webhook Notifications
SettingsAPI .right.> AlertDB : Manages Alert Settings
Supabase -left-> [Logging System] : Logs Workflow Executions
Logging System -up-> Detection : Provides Execution Logs

note right of Dispatcher
  Supports multiple channels:
  - Email
  - SMS
  - Webhook
end note

note "User Configuration\nand Alert Criteria" as UserConfig
UserConfig ..> SettingsAPI : Configures Alerts
UserConfig ..> Detection : Defines Criteria

class EmailProvider {
  SMTP Configuration
  Send Email()
}

class WebhookProvider {
  Webhook URLs
  Invoke Webhook()
}

@enduml