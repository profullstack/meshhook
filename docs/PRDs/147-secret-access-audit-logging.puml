@startuml
!theme plain

title Secret Access Audit Logging System

package "MeshHook System" {
    [Webhook Service] as Webhook
    [Workflow Engine] as Engine
    [Supabase Realtime] as Realtime
    [Postgres Database] as DB
}

package "Secrets Encryption" {
    [Secret Management] as Secrets
    [Audit Logging Service] as AuditLog
}

package "External Services" {
    [Supabase Storage] as Storage
}

Webhook --> Secrets : triggers secret access
Engine --> Secrets : requests secret decryption
Secrets --> DB : fetches secret
DB --> Secrets : returns secret
Secrets --> AuditLog : logs secret access
AuditLog --> DB : stores audit record
Realtime -left-> AuditLog : streams audit logs
AuditLog .right.> Storage : archives logs periodically

note right of AuditLog
  Key Features:
  - Secret access tracking
  - Real-time log streaming
  - Log archiving
end note

@enduml