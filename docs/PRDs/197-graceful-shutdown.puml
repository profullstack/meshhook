@startuml
!theme plain

title Graceful Shutdown Process

actor Client
boundary "Web Server" as WebServer
control "Orchestrator" as Orchestrator
database "Postgres" as Postgres
collections "Supabase Services" as Supabase
entity "Existing Components" as Existing

Client -> WebServer : Request Shutdown
WebServer -> Orchestrator : Signal Shutdown
Orchestrator -> Orchestrator : Finish Current Tasks
Orchestrator -> Postgres : Update State
Postgres -> Orchestrator : Acknowledge
Orchestrator -> Supabase : Flush Logs
Supabase -> Orchestrator : Confirm Flush
Orchestrator -> Existing : Notify Dependencies
Existing -> Orchestrator : Acknowledge Shutdown
Orchestrator -> WebServer : Shutdown Complete
WebServer -> Client : Acknowledge

note right of Orchestrator : Graceful shutdown\nensures all tasks are\nsafely completed or stored

@enduml