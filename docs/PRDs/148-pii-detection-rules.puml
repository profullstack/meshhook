@startuml
!theme plain

package "MeshHook System" {
    [SvelteKit UI] - [Rule Management API]
    [Rule Management API] --> [PII Detection Rule Engine]: Uses
    [PII Detection Rule Engine] --> [Supabase Postgres]: Stores rules & logs
    [Worker] --> [PII Detection Rule Engine]: Extends
    database "Supabase Postgres" {
        [pii_rules]
        [pii_audit_logs]
    }
}

[SvelteKit UI] --> [Rule Management API]: CRUD operations
[Rule Management API] --> [pii_rules]: Updates
[pii_rules] --> [PII Detection Rule Engine]: Defines rules
[PII Detection Rule Engine] --> [pii_audit_logs]: Writes logs

cloud {
    [External Data Sources]
}

[External Data Sources] --> [Worker]: Data payloads
[Worker] --> [PII Detection Rule Engine]: Detect & redact/encrypt PII
[PII Detection Rule Engine] --> [Supabase Postgres]: Encrypted PII & Audit logs

note right of [PII Detection Rule Engine]
  Implementations must ensure:
  - Sub 10ms processing overhead
  - 99.9% success rate for PII detection
  - Compliance with security best practices
end note

note right of [pii_rules]
  Stores:
  - Rule definitions
  - Configurations for PII detection
end note

note right of [pii_audit_logs]
  Records:
  - Actions on detected PII
  - Excludes PII itself for privacy
end note

@enduml