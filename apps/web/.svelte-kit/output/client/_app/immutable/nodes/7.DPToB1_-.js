import"../chunks/CWj6FrbW.js";import{ab as Z,a8 as oe,a9 as ne,aa as x,ad as ee,J as l,al as ie,ac as T,ag as c,af as v,ah as d,aj as $,am as j,ak as C,b as le,an as p,ae as de}from"../chunks/DLTaHJlt.js";import{d as te,s as P,a as ce}from"../chunks/BZOnZgKm.js";import{i as R}from"../chunks/D6SFIRjf.js";import{s as se,r as fe}from"../chunks/C21iDxsO.js";import{b as ue}from"../chunks/au-VDWBU.js";import{W as ve}from"../chunks/BBCkNNU0.js";import{N as he}from"../chunks/CLU3ntyR.js";import{e as pe,i as ge}from"../chunks/B9wM4kaC.js";import{p as X}from"../chunks/B90PUMjC.js";import{g as we}from"../chunks/jEEpMCDI.js";function me(a,e){e(!e())}var _e=T('<li class="error-item svelte-1fs7n2f"><span class="error-icon svelte-1fs7n2f">•</span> <span class="error-text svelte-1fs7n2f"> </span></li>'),ke=T('<div class="panel-body svelte-1fs7n2f"><ul class="error-list svelte-1fs7n2f"></ul></div>'),be=T('<div><button class="panel-header svelte-1fs7n2f"><div class="header-content svelte-1fs7n2f"><span class="icon svelte-1fs7n2f">⚠️</span> <span class="title svelte-1fs7n2f"> </span></div> <span class="toggle-icon svelte-1fs7n2f"> </span></button> <!></div>');function Ee(a,e){Z(e,!0);let r=X(e,"errors",19,()=>[]),s=X(e,"isOpen",15,!0);const t=ie(()=>r().length>0);var o=oe(),f=ne(o);{var i=u=>{var g=be();let w;var m=c(g);m.__click=[me,s];var _=c(m),b=v(c(_),2),D=c(b);d(b),d(_);var E=v(_,2),V=c(E,!0);d(E),d(m);var q=v(m,2);{var S=h=>{var y=ke(),L=c(y);pe(L,21,r,ge,(U,k)=>{var W=_e(),H=v(c(W),2),J=c(H,!0);d(H),d(W),$(()=>P(J,l(k))),x(U,W)}),d(L),d(y),x(h,y)};R(q,h=>{s()&&h(S)})}d(g),$(h=>{w=se(g,1,"validation-panel svelte-1fs7n2f",null,w,h),P(D,`Validation Issues (${r().length??""})`),P(V,s()?"▼":"▶")},[()=>({collapsed:!s()})]),x(u,g)};R(f,u=>{l(t)&&u(i)})}x(a,o),ee()}te(["click"]);function Y(a){const e=[];if(!a)return{isValid:!1,errors:["Workflow is required"]};const{nodes:r=[],edges:s=[]}=a;r.length===0&&e.push("Workflow must have at least one node");const t=ye(r);e.push(...t);const o=je(s,r);e.push(...o);const f=Ce(r,s);e.push(...f);const i=xe(r,s);e.push(...i);const u=Se(r,s);return e.push(...u),{isValid:e.length===0,errors:e}}function ye(a){const e=[],r=new Set;return a.forEach((s,t)=>{var o;if(r.has(s.id)&&e.push(`Duplicate node ID: ${s.id}`),r.add(s.id),s.id||e.push(`Node at index ${t} is missing an ID`),s.type||e.push(`Node ${s.id||t} is missing a type`),(o=s.data)!=null&&o.config){const f=Ne(s);e.push(...f)}}),e}function Ne(a){const e=[],{type:r,data:s}=a,t=(s==null?void 0:s.config)||{};switch(r){case"httpCall":t.url?$e(t.url)||e.push(`Node ${a.id}: Invalid URL format`):e.push(`Node ${a.id}: URL is required for HTTP Call`),t.method||e.push(`Node ${a.id}: HTTP method is required`);break;case"transform":t.expression||e.push(`Node ${a.id}: JMESPath expression is required for Transform`);break;case"delay":(!t.duration||t.duration<0)&&e.push(`Node ${a.id}: Valid duration is required for Delay`);break;case"conditional":t.condition||e.push(`Node ${a.id}: Condition is required for Conditional`);break}return e}function je(a,e){const r=[],s=new Set(e.map(t=>t.id));return a.forEach((t,o)=>{t.source||r.push(`Edge at index ${o} is missing source`),t.target||r.push(`Edge at index ${o} is missing target`),t.source&&!s.has(t.source)&&r.push(`Edge ${t.id||o}: Source node ${t.source} does not exist`),t.target&&!s.has(t.target)&&r.push(`Edge ${t.id||o}: Target node ${t.target} does not exist`),t.source===t.target&&r.push(`Edge ${t.id||o}: Node cannot connect to itself`)}),r}function Ce(a,e){const r=[],s=We(a,e),t=new Set,o=new Set;function f(i,u=[]){if(o.has(i)){const w=[...u,i].join(" → ");return r.push(`Cycle detected: ${w}`),!0}if(t.has(i))return!1;t.add(i),o.add(i);const g=s.get(i)||[];for(const w of g)if(f(w,[...u,i]))return!0;return o.delete(i),!1}for(const i of a)t.has(i.id)||f(i.id);return r}function xe(a,e){const r=[];if(a.length===0)return r;const s=new Set;return e.forEach(t=>{s.add(t.source),s.add(t.target)}),a.length===1||a.forEach(t=>{var o;s.has(t.id)||r.push(`Node ${t.id} (${((o=t.data)==null?void 0:o.label)||t.type}) is not connected`)}),r}function Se(a,e){const r=[],s=new Set(e.map(o=>o.target));return a.filter(o=>!s.has(o.id)).length===0&&a.length>0&&r.push("Workflow must have at least one trigger node (node with no incoming connections)"),r}function We(a,e){const r=new Map;return a.forEach(s=>{r.set(s.id,[])}),e.forEach(s=>{r.has(s.source)&&r.get(s.source).push(s.target)}),r}function $e(a){try{return new URL(a),!0}catch{return!1}}function Pe(a,e){confirm("Publish this workflow? Published workflows are immutable.")&&e(!0)}var Te=()=>we("/workflows"),De=(a,e)=>e(!1),Ve=T('<button class="btn-primary svelte-33tnje">Publish</button>'),qe=T('<div class="workflows-page svelte-33tnje"><header class="page-header svelte-33tnje"><div class="header-content svelte-33tnje"><div class="header-left svelte-33tnje"><button class="btn-back svelte-33tnje">← Back</button> <div class="workflow-info svelte-33tnje"><input type="text" class="workflow-name-input svelte-33tnje" placeholder="Workflow name"/> <span> </span></div></div> <div class="header-actions svelte-33tnje"><button class="btn-secondary svelte-33tnje"> </button> <!></div></div></header> <div class="workflow-container svelte-33tnje"><!> <div class="editor-container svelte-33tnje"><!></div></div> <!></div>');function Ie(a,e){var B,F,z,G,I,K,Q;Z(e,!0);let r=j(C(((F=(B=e.data.workflow)==null?void 0:B.definition)==null?void 0:F.nodes)||[])),s=j(C(((G=(z=e.data.workflow)==null?void 0:z.definition)==null?void 0:G.edges)||[])),t=j(C(((I=e.data.workflow)==null?void 0:I.name)||"Untitled Workflow")),o=C(((K=e.data.workflow)==null?void 0:K.description)||""),f=j(C(((Q=e.data.workflow)==null?void 0:Q.status)||"draft")),i=j(!1),u=j(C([]));le(()=>{const n=Y({nodes:l(r),edges:l(s)});p(u,n.errors,!0)});function g(n){p(r,n,!0)}function w(n){p(s,n,!0)}async function m(n=!1){try{if(p(i,!0),!Y({nodes:l(r),edges:l(s)}).isValid&&n){alert("Cannot publish workflow with validation errors");return}if(!(await fetch(`/api/workflows/${e.data.workflow.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:l(t),description:o,nodes:l(r),edges:l(s),status:n?"published":"draft"})})).ok)throw new Error("Failed to save workflow");p(f,n?"published":"draft",!0),alert(n?"Workflow published!":"Workflow saved as draft")}catch(N){alert(`Error saving workflow: ${N.message}`)}finally{p(i,!1)}}var _=qe();ce(n=>{$(()=>de.title=`Edit ${l(t)??""} - MeshHook`)});var b=c(_),D=c(b),E=c(D),V=c(E);V.__click=[Te];var q=v(V,2),S=c(q);fe(S);var h=v(S,2);let y;var L=c(h,!0);d(h),d(q),d(E);var U=v(E,2),k=c(U);k.__click=[De,m];var W=c(k,!0);d(k);var H=v(k,2);{var J=n=>{var N=Ve();N.__click=[Pe,m],$(()=>N.disabled=l(i)||l(u).length>0),x(n,N)};R(H,n=>{l(f)==="draft"&&n(J)})}d(U),d(D),d(b);var M=v(b,2),O=c(M);he(O,{});var A=v(O,2),re=c(A);ve(re,{onNodesChange:g,onEdgesChange:w,get nodes(){return l(r)},set nodes(n){p(r,n,!0)},get edges(){return l(s)},set edges(n){p(s,n,!0)}}),d(A),d(M);var ae=v(M,2);Ee(ae,{get errors(){return l(u)}}),d(_),$(n=>{y=se(h,1,"status-badge svelte-33tnje",null,y,n),P(L,l(f)),k.disabled=l(i),P(W,l(i)?"Saving...":"Save Draft")},[()=>({published:l(f)==="published"})]),ue(S,()=>l(t),n=>p(t,n)),x(a,_),ee()}te(["click"]);export{Ie as component};
